<!DOCTYPE html>
<html color-mode="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="ucs_libraries/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="ucs_libraries/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" type="text/css" href="ucs_libraries/flags32.css" />

    <title>UCS Renaming Tool</title>
    <link rel="icon" type="image/png" href="ucs_libraries/ucs_logo_black_on_white.png">

    <style>
        /* Light Mode CSS Vars */
        :root[color-mode="light"] {
            --text-color: #333333;
            --background-color: #ffffff;
            --border-color: black;
            --navbar-background: #cccccc;
            --navbar-text: #000000;
            --modal-background:  #ffffff;
        }

        /* Dark Mode CSS Vars */
        :root[color-mode="dark"] {
            --text-color: #ffffff;
            --background-color: #2c3034;
            --border-color: white;
            --navbar-background: #1b1f22;
            --navbar-text:  #ffffff;
            --modal-background:  #282b2e;
        }
        
        :root[color-mode="light"] .light--hidden {
            display: none;
        }

        :root[color-mode="dark"] .dark--hidden {
            display: none;
        }
        
        /* Main */
        #main_wrap {
            margin: 0 auto;
            width: 960px;
            position: relative;
            overflow-x: hidden;
        }

        /* Divs */
        div {
            margin-top: 10px;
            margin-bottom: 10px;
            margin-right: 30px;
            margin-left: 30px;
        }

        /* Page body */
        body {
            padding-top: 70px;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 1s, color 1s;
        }

        /* Headings */
        h3 {
            margin-top: 40px;
        }

        h5 {
            display: flex;
            width: 30%;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

            h5:before,
            h5:after {
                content: '';
                border-top: 2px solid;
                margin: 0 20px 0 0;
                flex: 1 0 20px;
            }

            h5:after {
                margin: 0 0 0 20px;
            }

        h7 {
            margin-top: 40px;
        }

        /* Selects and Drop Downs*/
        select {
            margin-top: 10px;
        }

        .dropdown-menu {
            color: var(--text-color);
            background-color: var(--navbar-background);
        }

        .dropdown-item {
            color: var(--text-color);
            background-color: var(--navbar-background);
        }

        /* Horizontal line */
        hr {
            border: 1px solid var(--border-color);
            transition: border 1s;
        }

        /* Form elements */
        .form-group label, input, select {
            color: var(--text-color) !important;
            background-color: var(--background-color) !important;
            transition: background-color 1s, color 1s;
        }

        /* Cards */
        .card {
            color: var(--text-color) !important;
            background-color: var(--background-color) !important;
            transition: background-color 1s, color 1s;
        }

        /* Modal */
        .modal-content {
            color: var(--text-color) !important;
            background-color: var(--modal-background) !important;
        }

        .modal-backdrop {
            margin: 0;
        }

        .modal-heading {
            margin-top: 30px;
            font-style: italic;
        }

        /* Row Click Alert */
        .notification {
            display: none;
            position: sticky;
            top: 100px;
            right: 20px;
            width: 250px;
            justify-content: right;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'Helvetica';
        }

        /* Form Field Required */
        .form-group.required .control-label:after {
            content: "*";
            color: red;
        }

        /* Buttons */
        button {
            height: 45px;
            line-height: 120px;
            margin: 5px;
            white-space: pre;
        }

        /* Button Icons */
        .icons {
            position: relative;
            display: inline-block;
            speak: none;
            font-style: normal;
            font-weight: normal;
            width: 16px;
            height: auto;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* BUTTON COLOR FILTERS */
        .filter-green {
            filter: invert(24%) sepia(76%) saturate(458%) hue-rotate(82deg) brightness(94%) contrast(95%);
        }

        .filter-yellow {
            filter: invert(41%) sepia(80%) saturate(1700%) hue-rotate(29deg) brightness(96%) contrast(94%);
        }

        .filter-blue {
            filter: invert(16%) sepia(74%) saturate(2294%) hue-rotate(198deg) brightness(104%) contrast(101%);
        }

        /* BUTTON SUBMISSION ANIMATION */
        .anim-trig {
            animation: fadeOutRight 1s ease-in-out 0s 1 normal;
        }

        @-webkit-keyframes fadeOutRight {
            0% {
                opacity: 1
            }

            to {
                opacity: 0;
                -webkit-transform: translate3d(120%,0,0) scale3d(0.6, 0.6, 0.6);
                transform: translate3d(120%,0,0) scale3d(0.6, 0.6, 0.6)
            }
        }

        @keyframes fadeOutRight {
            0% {
                opacity: 1
            }

            to {
                opacity: 0;
                -webkit-transform: translate3d(120%,0,0) scale3d(0.6, 0.6, 0.6);
                transform: translate3d(120%,0,0) scale3d(0.6, 0.6, 0.6)
            }
        }

        /* DATATABLES SEARCH BAR & PAGINATION */
        .dtSearch {
            align-items: flex-start;
            display: flex;
            margin-left: auto;
            justify-content: left;
            margin-top: 15px;
        }

        .dtPages {
            align-items: center;
            display: flex;
            justify-content: center;
        }

        /* TYPEAHEAD x BOOTSTRAP FORMATTING */
        span.twitter-typeahead .tt-menu,
        span.twitter-typeahead .tt-dropdown-menu {
            cursor: pointer;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            display: none;
            float: left;
            min-width: 160px;
            padding: 5px 0;
            margin: 2px 0 0;
            list-style: none;
            font-size: 14px;
            text-align: center;
            background-color: var(--background-color);
            transition: background-color 1s;
            border: 1px solid #cccccc;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
            background-clip: padding-box;
        }

        span.twitter-typeahead .tt-suggestion {
            display: block;
            padding: 3px 20px;
            clear: both;
            font-weight: normal;
            line-height: 1.42857143;
            color: var(--text-color);
            transition: color 1s;
            white-space: nowrap;
        }

            span.twitter-typeahead .tt-suggestion.tt-cursor,
            span.twitter-typeahead .tt-suggestion:hover,
            span.twitter-typeahead .tt-suggestion:focus {
                color: #ffffff;
                text-decoration: none;
                outline: 0;
                background-color: #337ab7;
            }

        .input-group.input-group-lg span.twitter-typeahead .form-control {
            height: 46px;
            padding: 10px 16px;
            font-size: 18px;
            line-height: 1.3333333;
            border-radius: 6px;
        }

        .input-group.input-group-sm span.twitter-typeahead .form-control {
            height: 30px;
            padding: 5px 10px;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 3px;
        }

        span.twitter-typeahead {
            width: 100%;
        }

        .input-group span.twitter-typeahead {
            display: block !important;
            height: 34px;
        }

            .input-group span.twitter-typeahead .tt-menu,
            .input-group span.twitter-typeahead .tt-dropdown-menu {
                top: 32px !important;
            }

            .input-group span.twitter-typeahead:not(:first-child):not(:last-child) .form-control {
                border-radius: 0;
            }

            .input-group span.twitter-typeahead:first-child .form-control {
                border-top-left-radius: 4px;
                border-bottom-left-radius: 4px;
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
            }

            .input-group span.twitter-typeahead:last-child .form-control {
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
                border-top-right-radius: 4px;
                border-bottom-right-radius: 4px;
            }

        .input-group.input-group-sm span.twitter-typeahead {
            height: 30px;
        }

            .input-group.input-group-sm span.twitter-typeahead .tt-menu,
            .input-group.input-group-sm span.twitter-typeahead .tt-dropdown-menu {
                top: 30px !important;
            }

        .input-group.input-group-lg span.twitter-typeahead {
            height: 46px;
        }

            .input-group.input-group-lg span.twitter-typeahead .tt-menu,
            .input-group.input-group-lg span.twitter-typeahead .tt-dropdown-menu {
                top: 46px !important;
            }

        /* Datatables pagination buttons */
        .page-item.active .page-link {
            color: var(--text-color) !important;
            background-color: var(--background-color) !important;
            transition: background-color 1s, color 1s;
        }

        .page-link {
            color: var(--text-color) !important;
            background-color: var(--background-color) !important;
            transition: background-color 1s, color 1s;
        }
    </style>
    <script src="/main.js"></script>
    <script type="text/javascript" src="ucs_libraries/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="ucs_libraries/popper.min.js"></script>
    <script type="text/javascript" src="ucs_libraries/bootstrap.min.js"></script>
    <script type="text/javascript" src="ucs_libraries/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="ucs_libraries/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="ucs_libraries/typeahead.bundle.js"></script>
    <script type="text/javascript" src="ucs_libraries/countrystatecity.js"></script>
</head>
<body>
    <!--------------->
    <!--- NAVBAR ---->
    <!--------------->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="background-color: var(--navbar-background); color: var(--navbar-text); transition: background-color 1s, color 1s;" id="ucsNavbar">
        <a class="navbar-brand" href="#">
            <img src="ucs_libraries/ucs_logo_white_on_black.png" width="30" height="30" class="d-inline-block align-top" alt="">
            <b>&nbsp;UCS Reaper Renaming Tool</b>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" style="white-space: normal;">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto f32" style="display: flex; align-items: center; justify-content: center;">
                <li class="nav-item active" id="namingScroll">
                    <a class="nav-link" href="#">Naming<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item" id="processingScroll">
                    <a class="nav-link" href="#userInputData">Processing</a>
                </li>
                <li class="nav-item" id="metadataScroll">
                    <a class="nav-link" href="#userInputArea">Metadata</a>
                </li>
                <li class="nav-item" id="dataScroll">
                    <a class="nav-link" href="#formSubmitButton">UCS Table</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarPresetsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display: flex; align-items: center; justify-content: center;">
                        Presets
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarPresetsDropdown" id="navbarPresetsDropdownOptions">
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" id="saveThisAsPreset" onClick="showPresetModal()" style="display: flex; align-items: center;">Save As Preset...</a>
                        <a class="dropdown-item" href="#" id="saveThisAsPreset" onClick="showDeletePresetModal()" style="display: flex; align-items: center;">Delete Preset...</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarLangDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="display: flex; align-items: center; justify-content: center;">
                        Language
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarLangDropdown">
                        <a class="dropdown-item" href="#" id="langEN" style="display: flex; align-items: center;"><i class="flag us"></i>&nbsp;&nbsp;English</a>
                        <a class="dropdown-item" href="#" id="langES" style="display: flex; align-items: center;"><i class="flag es"></i>&nbsp;&nbsp;Spanish</a>
                        <a class="dropdown-item" href="#" id="langFR" style="display: flex; align-items: center;"><i class="flag fr"></i>&nbsp;&nbsp;French</a>
                        <a class="dropdown-item" href="#" id="langDE" style="display: flex; align-items: center;"><i class="flag de"></i>&nbsp;&nbsp;German</a>
                        <a class="dropdown-item" href="#" id="langIT" style="display: flex; align-items: center;"><i class="flag it"></i>&nbsp;&nbsp;Italian</a>
                        <a class="dropdown-item" href="#" id="langPL" style="display: flex; align-items: center;"><i class="flag pl"></i>&nbsp;&nbsp;Polish</a>
                        <a class="dropdown-item" href="#" id="langNL" style="display: flex; align-items: center;"><i class="flag nl"></i>&nbsp;&nbsp;Dutch</a>
                        <a class="dropdown-item" href="#" id="langDA" style="display: flex; align-items: center;"><i class="flag dk"></i>&nbsp;&nbsp;Danish</a>
                        <a class="dropdown-item" href="#" id="langNO" style="display: flex; align-items: center;"><i class="flag no"></i>&nbsp;&nbsp;Norwegian</a>
                        <a class="dropdown-item" href="#" id="langSE" style="display: flex; align-items: center;"><i class="flag se"></i>&nbsp;&nbsp;Swedish</a>
                        <a class="dropdown-item" href="#" id="langFI" style="display: flex; align-items: center;"><i class="flag fi"></i>&nbsp;&nbsp;Finnish</a>
                        <a class="dropdown-item" href="#" id="langPT" style="display: flex; align-items: center;"><i class="flag pt"></i>&nbsp;&nbsp;Portuguese</a>
                        <a class="dropdown-item" href="#" id="langPTBR" style="display: flex; align-items: center;"><i class="flag br"></i>&nbsp;&nbsp;Portuguese-Brazil</a>
                        <a class="dropdown-item" href="#" id="langZH" style="display: flex; align-items: center;"><i class="flag cn"></i>&nbsp;&nbsp;Chinese</a>
                        <a class="dropdown-item" href="#" id="langJA" style="display: flex; align-items: center;"><i class="flag jp"></i>&nbsp;&nbsp;Japanese</a>
                        <a class="dropdown-item" href="#" id="langTW" style="display: flex; align-items: center;"><i class="flag tw"></i>&nbsp;&nbsp;Taiwanese</a>
                        <a class="dropdown-item" href="#" id="langRU" style="display: flex; align-items: center;"><i class="flag ru"></i>&nbsp;&nbsp;Russian</a>
                        <a class="dropdown-item" href="#" id="langUA" style="display: flex; align-items: center;"><i class="flag ua"></i>&nbsp;&nbsp;Ukrainian</a>
                    </div>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0" style="display: flex; align-items: center; justify-content: center;">
                <!-- SETTINGS MENU -->
                <a type="button" class="btn btn-outline-dark dark--hidden" data-toggle="modal" data-target=".settings-modal"><img src="ucs_libraries/settings-icon-dark.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Settings</a>
                <a type="button" class="btn btn-outline-light light--hidden" data-toggle="modal" data-target=".settings-modal"><img src="ucs_libraries/settings-icon-light.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Settings</a>
            </form>
        </div>
    </nav>
    
    <!------------------------>
    <!---  SETTINGS MENU  ---->
    <!------------------------>
    <div class="modal fade settings-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h3 style="margin:0;" class="modal-title">UCS Renaming Tool Settings</h4>
              </div>
              <div class="modal-body">
                <!------------------------>
                <!---  PROCESSING     ---->
                <!------------------------>
                <h5><i>Processing</i></h5>
                <!-- VENDOR CATEGORY -->
                <p style="margin-bottom:0px;">Vendor Category:</p>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="vendorCatCheckbox">
                    <h7>Show Vendor Category field? Only relevant for library vendors.</h7>
                </div>                
                <!-- DISABLE CAPITALIZATION -->
                <p style="margin-bottom:0px;margin-top:15px;">Automatic Capitalization:</p>
                <small class="form-text text-muted">Creator ID, Source ID, User Category, Vendor Category</small>
                <select id="nameCapitalizationSetting" class="form-control">
                    <option>ALL CAPS (Default)</option>
                    <option>Title Case</option>
                    <option>Disable automatic capitalization</option>
                </select>
                <!-- COPY RESULTS -->
                <p style="margin-bottom:0px;margin-top:15px;">Copy to Clipboard:</p>
                <select id="copyResultsSetting" class="form-control">
                    <option>Do not copy (Default)</option>
                    <option>Copy after processing</option>
                    <option>Copy WITHOUT processing</option>
                </select>
                <div id="copyResultsWarning" style="margin:0;" class="alert alert-warning" role="alert">This will bypass the processing section and <i>just copy to clipboard</i>.</div>

                <!------------------------>
                <!---  UCS TABLE      ---->
                <!------------------------>
                <h5 class="modal-heading" style="margin-top:35px;">UCS Table</h5>
                <!-- AUTO SUBMIT FORM ON ROW CLICK -->
                <p style="margin-bottom:0px;">Auto Submit:</p>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="autoSubmitCheckbox">
                    <h7>Automatically submit form data when clicking table rows?</h7>
                </div>
                <!-- AUTO SEARCH MEDIA EXPLORER -->
                <p style="margin-bottom:0px;margin-top:25px;">Filter Media Explorer:</p>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="autoSearchCatSubcatCheckbox">
                    <h7>Search media explorer for category/subcategory when clicking table rows?</h7>
                </div>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="autoSearchSynonymsCheckbox">
                    <h7>Search media explorer for synonyms when clicking table rows?</h7>
                </div>

                <!------------------------>
                <!--- RENDER METADATA  --->
                <!------------------------>
                <h5 class="modal-heading" style="margin-top:35px;">Metadata</h5>
                <!-- UCS Metadata -->
                <p style="margin-bottom:0px;">Render UCS Metadata:</p>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="iXMLSettings">
                    <h7>Embed UCS form info in metadata when rendering?</h7>
                </div>
                <!-- Extended Metadata -->
                <p style="margin-bottom:0px;">Render Additional Fields:</p>
                <div class="form-check" style="margin-left:0px">
                    <input class="form-check-input" type="checkbox" id="metadataSettings">
                    <h7>Show extended metadata input fields like microphone, perpective, location, etc?</h7>
                </div>
                <div id="metadataWarning" style="margin:0;" class="alert alert-warning" role="alert">- Render Metadata requires 'Embed: Metadata' to be checked in your render settings<br>- Render Metadata does <b>NOT</b> apply when renaming Tracks<br>- Render Metadata fields are all optional, and can be left blank.</div>

                <!------------------------>
                <!---  APPEARANCE     ---->
                <!------------------------>
                <h5 class="modal-heading" style="margin-top:35px;">Appearance</h5>
                <!-- COLOR MODE -->
                <a class="btn color-mode__btn btn-outline-light light--hidden"><img src="ucs_libraries/light-mode-icon.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Light Mode</a>
                <a class="btn color-mode__btn btn-outline-dark dark--hidden"><img src="ucs_libraries/dark-mode-icon.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Dark Mode</a>
                
                <!------------------------>
                <!---  LINKS          ---->
                <!------------------------>
                <h5 class="modal-heading" style="margin-top:35px;">External Links</h5>
                <!-- FEEDBACK -->
                <a href="https://forms.gle/DaVCaesTLcRLrJVt7" class="btn btn-outline-dark dark--hidden" target="_blank"><img src="ucs_libraries/dark-feedback-icon.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Feedback</a>
                <a href="https://forms.gle/DaVCaesTLcRLrJVt7" class="btn btn-outline-light light--hidden" target="_blank"><img src="ucs_libraries/light-feedback-icon.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;Feedback</a>
                <!-- UCS WEBSITE -->
                <a href="https://universalcategorysystem.com/" class="btn btn-outline-dark dark--hidden" target="_blank" style="margin-left:20px"><img src="ucs_libraries/ucs_logo_white_on_black.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;UCS Website</a>
                <a href="https://universalcategorysystem.com/" class="btn btn-outline-light light--hidden" target="_blank" style="margin-left:20px"><img src="ucs_libraries/ucs_logo_black_on_white.png" width="25" height="25" class="d-inline-block align-top" alt="">&nbsp;UCS Website</a>
              </div>
              <div class="modal-footer">
                <p class="mr-auto">Developed by&nbsp;<a href="https://aaroncendan.me" target="_blank">Aaron Cendan</a>. Feel free to&nbsp;<a href="https://ko-fi.com/acendan_" target="_blank">buy me a coffee!</a></p>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
            </div>
        </div>
    </div>

    <!------------------------>
    <!---  PRESETS MODALS ---->
    <!------------------------>
    <!---  Save Preset    ---->
    <div class="modal fade" id="presetsModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 style="margin:0;" class="modal-title">Save Current Settings</h4>
                </div>
                <div class="modal-body">
                    <label for="presetNameLabel">Preset Name</label>
                    <input type="text" class="form-control" id="presetName" aria-describedby="presetNameHelp" placeholder="Chihuahua Recordings">
                    <small id="presetNameHelp" class="form-text text-muted">- A preset named "Default" will load as soon as you open the tool<br>- Presets will collect ALL field info. <b>I recommend leaving Category, Subcategory, and Filename blank.</b></small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onClick="saveThisAsPreset()" data-dismiss="modal">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!---  Delete Preset ---->
    <div class="modal fade" id="deletePresetsModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 style="margin:0;" class="modal-title">Delete Preset</h4>
                </div>
                <div class="modal-body">
                    <label for="presetNameLabel">Preset To Delete...</label>
                    
                    <select id="deletePresetSelect" class="form-control">

                    </select>

                    <small class="form-text text-muted"><b>WARNING: </b>This is irreversible. There is no undo.</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onClick="deleteThisPreset()" data-dismiss="modal">Delete Preset</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                  </div>
            </div>
        </div>
    </div>


    <!------------------------>
    <!--- ROW CLICK ALERT ---->
    <!------------------------>
    <div class="alert alert-success notification float-right copy-alert" style="position: fixed; z-index:100;" role="alert" id="copiedRowAlert">
        Copied data to form!
    </div>

    <div class="main_wrap">
        <!------------------------>
        <!-- Renaming Tool Form -->
        <!------------------------>
        <form id="ucsForm">
            <!-- NAMING SECTION -->
            <div style="margin-top:40px;"><h5 id="naming"><i>Naming</i></h5></div>

            <div class="form-row">
                <!-- Category -->
                <div class="form-group col-md-6 required" id="typeaheadCategory">
                    <label for="userInputCategoryLabel">Category*</label>
                    <br><input type="text" class="form-control typeahead" id="userInputCategory" aria-describedby="userInputCategoryHelp" placeholder="What kind of sound is this?" required>
                    <div id="userInputCategoryError" style="display: none; margin:0;" class="alert alert-warning" role="alert">No valid CatID found. Please check your Category & Subcategory selections!</div>
                    <small id="userInputCategoryHelp" class="form-text text-muted">Start typing to auto-fill category.</small>
                </div>

                <!-- Subcategory -->
                <div class="form-group col-md-6 required" id="typeaheadSubcategory">
                    <label for="userInputSubCategoryLabel">Subcategory*</label>
                    <select class="form-control" id="userSelectSubCategory" required><option>Please select a category!</option></select>
                    <small id="userInputSubCategoryHelp" class="form-text text-muted">Subcategory dropdown will fill with options when Category is selected. "-" if no subcategory needed.</small>
                </div>

                <!-- User Category -->
                <div class="form-group col-md-6" id="userCategoryGroup">
                    <label for="userInputUserCatLabel">User Category</label>
                    <input type="text" class="form-control" id="userInputUserCat" aria-describedby="userInputUserCatHelp" placeholder="Optional User Category">
                    <small id="userInputUserCatHelp" class="form-text text-muted">If no User Category, leave blank.</small>
                </div>

                <!-- Vendor Category -->
                <div class="form-group col-md-6" id="vendorCategoryGroup">
                    <label for="userInputVendCatLabel">Vendor Category</label>
                    <input type="text" class="form-control" id="userInputVendCat" aria-describedby="userInputVendCatHelp" placeholder="Optional Vendor Category">
                    <small id="userInputVendCatHelp" class="form-text text-muted">If you are not a library vendor, leave blank.</small>
                </div>

                <!-- Name w Var ID -->
                <div class="form-group col-md-6 required" id="fileNameGroup">
                    <label for="userInputNameLabel">File Name*</label>
                    <input type="text" class="form-control" id="userInputName" aria-describedby="userInputNameHelp" placeholder="Name your items using spaces (not underscores)." required pattern="(.|\s)*\S(.|\s)*">
                    <div id="userInputNameError" style="display: none; margin:0;" class="alert alert-warning" role="alert">File Name cannot be blank!</div>
                    <div class="form-check" style="margin-left:0px">
                        <input class="form-check-input" type="checkbox" checked id="userInputVarNumCheckbox">
                        <h7>Enable variation numbering?</h7>
                    </div>                    
                    <small id="userInputNameHelp" class="form-text text-muted"><b>WILDCARDS: </b>$region, $regionnumber<br />- Available wildcards are dependent on 'Items to Rename' field in <i>Processing</i> below.</small>
                </div>

                <!-- Initials -->
                <div class="form-group col-md-6" id="initialsGroup">
                    <label for="userInputInitialsLabel">Creator ID*</label>
                    <input type="text" class="form-control" id="userInputInitials" aria-describedby="userInputInitialsHelp" placeholder="Identifiable User ID" required pattern=".{1,}">
                    <div id="userInitialsError" style="display: none; margin:0;" class="alert alert-warning" role="alert">Initials cannot be blank!</div>
                    <small id="userInputInitialsHelp" class="form-text text-muted">Aaron Cendan, ACendan, AaCe, AACE, etc.</small>
                </div>

                <!-- Show -->
                <div class="form-group col-md-6">
                    <label for="userInputShowLabel">Source ID</label>
                    <input type="text" class="form-control" id="userInputShow" aria-describedby="userInputShowHelp" placeholder="Optional Project/Show ID">
                    <small id="userInputShowHelp" class="form-text text-muted">If none, leave blank; it will be replaced with "NONE" per the UCS guidelines.</small>
                </div>

                <!-- User Data -->
                <div class="form-group col-md-6">
                    <label for="userDataLabel">User Data/Notes</label>
                    <input type="text" class="form-control" id="userInputData" aria-describedby="userInputDataHelp" placeholder="Optional Notes">
                    <small id="userInputDataHelp" class="form-text text-muted">If none, leave blank.</small>
                </div>
            </div>

            <!-- PROCESSING SECTION -->
            <div><h5 id="processing"><i>Processing</i></h5></div>
            <div class="form-row">
                <div id="copyResultsWarning2" style="display: none;" class="alert alert-warning" role="alert">You currently have "Copy WITHOUT processing" enabled in the settings. Results will be copied to the clipboard, but nothing will be renamed in your session.</div>

                <!-- RENAME DROPDOWN - Rename Regions/Markers/Items/Tracks -->
                <div class="form-group col-md-6">
                    <h7>Items to Rename*</h7>
                    <select id="userInputItems" class="form-control">
                        <option>Regions</option>
                        <option>Markers</option>
                        <option>Media Items</option>
                        <option>Tracks</option>
                    </select>
                    <small id="userInputCategoryHelp" class="form-text text-muted">What would you like to rename?</small>
                </div>
                <!-- AREA DROPDOWN - Time Selection/Full Project - Default to Regions options-->
                <div class="form-group col-md-6">
                    <h7>Search Area*</h7>
                    <select id="userInputArea" class="form-control">
                        <option>Selected Regions in Region Manager</option>
                        <option>Edit Cursor</option>
                        <option>Time Selection</option>
                        <option>Full Project</option>
                    </select>
                    <small id="userInputCategoryHelp" class="form-text text-muted">Select the area of the project you would like to affect.</small>
                </div>
            </div>

            <!-- METADATA SECTION -->
            <div><h5 id="metadataTitle"><i>Metadata</i></h5></div>
            <div class="form-row" id="metadataSection">
                
                <!-- Description -->
                <div class="form-group col-md-6">
                    <label for="userDataLabel">Description</label>
                    <input type="text" class="form-control" id="userInputMetaDesc" placeholder="Fully Detailed Description of File Contents">
                </div>

                <!-- Title -->
                <div class="form-group col-md-9 custom-control-inline" style="margin-left: 0px; margin-top: 0px; margin-bottom: 0px;">
                    <div class="form-group col-md-4" style="margin-left: 15px; margin-right: 15px;">
                        <label for="userDataLabel">Title</label>
                        <input type="text" class="form-control" id="userInputMetaTitle" placeholder="SHORT CATCHY TITLE">
                    </div>

                    <!-- Keywords -->
                    <div class="form-group col-md-4" style="margin-left: 0px">
                        <label for="userDataLabel">Keywords</label>
                        <input type="text" class="form-control" id="userInputMetaKeys" placeholder="Comma, Separated, Keywords, Tags">
                    </div>
                </div>
                
                <!-- Microphone -->
                <div class="form-group col-md-9 custom-control-inline" style="margin-left: 0px; margin-top: 0px; margin-bottom: 0px;">
                    <div class="form-group col-md-4" style="margin-left: 15px; margin-right: 15px;">
                        <label for="userDataLabel">Microphone</label>
                        <input type="text" class="form-control" id="userInputMetaMic" placeholder="Mini MS">
                    </div>
                    
                    <div class="form-group col-md-4" style="margin-left: 0px">
                        <label for="userDataLabel">Recording Medium</label>
                        <input type="text" class="form-control" id="userInputMetaRecMed" placeholder="Sound Devices MixPre3II">
                    </div>                                        
                </div>

                <!-- Microphone Perspective -->
                <div class="form-group col-md-9 custom-control-inline" style="margin-left: 0px;  margin-top: 0px; margin-bottom: 0px;">
                    <div class="form-group col-md-4" style="margin-left: 15px; margin-right: 15px;">
                        <label for="userDataLabel">Microphone Perspective</label>                        
                        <select id="userInputMetaPersp" class="form-control" style="margin-top: 0px;">
                            <option>-</option>
                            <option>Close Up (CU)</option>
                            <option>Medium (MED)</option>
                            <option>Distant (DST)</option>
                            <option>Direct (DI)</option>
                            <option>Onboard (OB)</option>
                        </select>    
                    </div>
                    <div class="form-group col-md-4" style="margin-left: 0px">
                        <label for="userDataLabel">Indoor or Outdoor</label>
                        <select id="userInputMetaIntExt" class="form-control" style="margin-top: 0px;">
                            <option>-</option>
                            <option>Interior (INT)</option>
                            <option>Exterior (EXT)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Designer/URL -->
                <div class="form-group col-md-8 custom-control-inline" style="margin-left: 0px; margin-top: 0px; margin-bottom: 0px;">
                    <div class="form-group col-md-3" style="margin-left: 15px; margin-right: 15px;">
                        <label for="userDataLabel">Designer</label>
                        <input type="text" class="form-control" id="userInputMetaDsgnr" placeholder="Aaron Cendan">
                    </div>

                    <div class="form-group col-md-3" style="margin-left: 0px">
                        <label for="userDataLabel">Library</label>
                        <input type="text" class="form-control" id="userInputMetaLib" placeholder="Julibrary 2021">
                    </div>
                    
                    <div class="form-group col-md-3" style="margin-left: 0px">
                        <label for="userDataLabel">URL</label>
                        <input type="text" class="form-control" id="userInputMetaURL" placeholder="https://aaroncendan.me">
                    </div>
                </div>

                <!-- Location -->
                <div class="form-group col-md-8 custom-control-inline" style="margin-left: 0px; margin-top: 0px; margin-bottom: 0px;">
                    <!-- Country -->
                    <div class="form-group col-md-3" style="margin-left: 15px; margin-right: 15px;">
                        <label for="userDataLabel" style="margin-bottom: 0px;">Location</label>
                        <select name="country" class="form-control countries order-alpha" id="countryId">
                            <option value="">Select Country</option>
                        </select>
                        <small class="form-text text-muted">Country</small>
                    </div>

                    <!-- State -->
                    <div class="form-group col-md-3" style="margin-left: 0px; margin-top: 35px;">
                        <select name="state" class="form-control states order-alpha" id="stateId">
                            <option value="">Select State</option>
                        </select>
                        <small class="form-text text-muted">State</small>
                    </div>

                    <!-- City -->
                    <div class="form-group col-md-3" style="margin-left: 0px; margin-top: 35px;">
                        <select name="city" class="form-control cities order-alpha limit-pop-10000" id="cityId">
                            <option value="">Select City</option>
                        </select>
                        <small class="form-text text-muted">City</small>
                    </div>
                </div>

                <!-- Album Art -- DISABLED UNTIL MEDIA EXPLORER CAN SHOW ALBUM ART 
                <div class="form-group col-md-6">
                    <label class="form-label" for="customFile">Embed Artwork</label>
                    <input type="file" class="form-control" id="userInputMetaArt" aria-describedby="userInputMetaArtHelp"/>        
                    <small id="userInputMetaArtHelp" class="form-text text-muted">Supports drag-and-drop! Must be .jpg or .png</small>
                </div>
                -->
            </div>  
            <!-- SUBMIT BUTTON - Web_Interface_Button_1_Test.lua -->
            <div>
                <button id="formSubmitButton" type="button" class="btn btn-outline-primary"><img class="icons filter-blue" src="ucs_libraries/share.svg" alt="share_icon">&nbsp;&nbsp;<b>Submit</b></button>
            </div>
            <!-- PAGE DIVIDER -->
            <div><hr></div>
        </form>
        <!--------------->
        <!-- UCS Table -->
        <!--------------->
        <div>
            <h3 id="dataTable">Universal Category System Table</h3>
            <h6 id="UCSTableSubHeading">Google Sheets Data/Online Mode ~ UCS v8.0</h6>
            <!-- OFFLINE/ONLINE INFO - Displayed on load -->
            <h6 id="downloadUCSButtonText" style="display: none">Click here to download for offline use!</h6>
            <h6 id="reenableOnlineUCSButtonText" style="display: none">If you would like to re-enter 'Online Mode' using Google Sheets data, click here.</h6>
            <button id="downloadUCSButton" type="button" class="btn btn-outline-success" style="display: none; margin-top: 10px"><img class="icons filter-green" src="ucs_libraries/data-transfer-download.svg" alt="download_icon">&nbsp;&nbsp;<b>Download</b></button>
            <button id="onlineUCSButton" type="button" class="btn btn-outline-warning" style="display: none; margin-top: 10px"><img class="icons filter-yellow" src="ucs_libraries/wifi.svg" alt="wifi_icon">&nbsp;&nbsp;<b>Online</b></button>
            <div class="card border-dark w-75" id="UCSInstallInstructions" style="display: none">
                <div style="margin-top: 0px; margin-bottom: 0px; margin-right: 0px; margin-left: 0px;" class="card-body">
                    <h6 class="card-title">Offline Installation and Setup Instructions</h6>
                    <ul>
                        <li>
                            To enable offline mode, simply place the downloaded file "UCS.txt" in the appropriate directory:
                        </li>
                        <li>
                            Open the file path /REAPER/reaper_www_root (and verify that "acendan_Universal Category Renaming Tool Interface.html" is present).
                        </li>
                        <li>
                            Drag or copy the "UCS.txt" file into the folder /reaper_www_root and then reload this page.
                        </li>
                        <li>
                            You should see text above the UCS Table indicating that you are succesfully in Offline mode!
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card border-dark w-75" id="UCSOnlineModeInstructions" style="display: none">
                <div style="margin-top: 0px; margin-bottom: 0px; margin-right: 0px; margin-left: 0px;" class="card-body">
                    <h6 class="card-title">Re-enable Online Mode Instructions</h6>
                    <ul>
                        <li>
                            To re-enable online mode, open the file path /REAPER/reaper_www_root.
                        </li>
                        <li>
                            You can either delete "UCS.txt", change its name to something along the lines of "UCS_backup.txt", or place it in a folder/elsewhere on your computer.
                        </li>
                        <li>
                            Reload this page and you should automatically enter Online mode, using Google Sheets data for the latest UCS info.
                        </li>
                    </ul>
                </div>
            </div>
            <div style="margin-bottom:0px;margin-top:25px;">
                <h7><i>Search for an appropriate category then click on a row in the table to instantly fill out the form!</i></h7>                
            </div>
        </div>
        <table id="UCRTDataTable" class="table table-striped table-bordered table-hover table-responsive table-light" style="width:100%"></table>
        <div>
            <h7 style="align-items:center;display:flex;justify-content:center;">Have a great day! :)</h7>
        </div>
    </div>
    <script>
        // Initialize connection w Reaper
        wwr_start();

        // ~~~~~~~~~~~~~~~~~~~~
        // GLOBAL VAR DECLARATION
        // ~~~~~~~~~~~~~~~~~~~~
        // Reaper-side Lua Script
        // var UCSRTLua = "_RS2edfa4e08051e6b3d0d57c6e447310a7f1523549"; //ReaTeams/Various
        // var UCSRTLua = "_RS7c2f7ff876416263bd4e85ce292adfea0b19f95a"; //ACendan Scripts/Various/Universal Category Renaming Tool.lua
        var UCSRTLua = "_RS0d2de1418a084e66229cb513cdb6e8cc99fc7593"; //ACendan Scripts/Various/UCS Renaming Tool.lua
        var UCSMediaFilter = "_RS15f4b156ba3f21ef8806a3c4c1f04ff621d48c9a"; //ACendan Scripts/Various/acendan_UCS Renaming Tool - Media Explorer Filter.lua

        // Open Reaper resource path
        var REApath = "40027";

        // UCS Google Sheet Languages
        var ucs_gsheet_header = "https://spreadsheets.google.com/feeds/cells/10-IAYKOEpTMoDsv7m_oPZazPVY3HhhUS_hQeEjmK93c/";
        var ucs_gsheet_footer = "/public/full?alt=json";
        var ucs_gsheet_en = ucs_gsheet_header + "1" + ucs_gsheet_footer;
        var ucs_gsheet_fr = ucs_gsheet_header + "2" + ucs_gsheet_footer;
        var ucs_gsheet_pl = ucs_gsheet_header + "3" + ucs_gsheet_footer;
        var ucs_gsheet_de = ucs_gsheet_header + "4" + ucs_gsheet_footer;
        var ucs_gsheet_pt = ucs_gsheet_header + "5" + ucs_gsheet_footer;
        var ucs_gsheet_pt_br = ucs_gsheet_header + "6" + ucs_gsheet_footer;
        var ucs_gsheet_zh = ucs_gsheet_header + "7" + ucs_gsheet_footer;
        var ucs_gsheet_nl = ucs_gsheet_header + "8" + ucs_gsheet_footer;
        var ucs_gsheet_es = ucs_gsheet_header + "9" + ucs_gsheet_footer;
        var ucs_gsheet_ja = ucs_gsheet_header + "10" + ucs_gsheet_footer;
        var ucs_gsheet_it = ucs_gsheet_header + "11" + ucs_gsheet_footer;
        var ucs_gsheet_da = ucs_gsheet_header + "12" + ucs_gsheet_footer;
        var ucs_gsheet_fi = ucs_gsheet_header + "13" + ucs_gsheet_footer;
        var ucs_gsheet_tw = ucs_gsheet_header + "14" + ucs_gsheet_footer;
        var ucs_gsheet_no = ucs_gsheet_header + "15" + ucs_gsheet_footer;
        var ucs_gsheet_se = ucs_gsheet_header + "16" + ucs_gsheet_footer;
        var ucs_gsheet_ru = ucs_gsheet_header + "17" + ucs_gsheet_footer;
        var ucs_gsheet_ua = ucs_gsheet_header + "18" + ucs_gsheet_footer;

        // Arrays populated by Google Sheet public JSON
        // Cleaned up arrays for auto-filter
        var jsonFullTable = [];
        var jsonCategoryAutofill = [];
        var jsonSubcategoryAutofill = [];
        var jsonCategorySubcategoryArr = [];
        var jsonCatIDArr = [];

        // Init user preset array
        let userPresets = [];

        // Instructions toggle bool
        var onlineModeInstructionsToggle = true;

        // Platform specific bools
        var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));
        var isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;

        // Cache load start time
        var startTime = new Date().valueOf();

        // ~~~~~~~~~~~~~~~~~~~~
        // ON PAGE LOAD
        // Determine Online or Offline Mode
        // ~~~~~~~~~~~~~~~~~~~~
        $(function () {
            // Alert Safari users of issues with browser            
            if (isSafari) alert("Safari does not play nicely with this tool. I am working to resolve these issues, but until then, please consider using Google Chrome. Thank you for your understanding!");

            // Remove selected regions in region manager option for mac users
            // https://forum.cockos.com/showpost.php?p=2337785&postcount=1326
            if (isMac) $("#userInputArea option:contains('Selected Regions in Region Manager')").remove();

            // Get previous session settings from local storage
            recallSettings();

            // Assigns country icon for current language to navbar language dropdown
            getUCSLanguage();

            // Attempt to load offline "UCS.txt" file if available. If successful: useOfflineUSCData()
            // If not, get data from public Google sheet via function: useGSheetsUSCData()
            loadOfflineUCSDoc();

            // Check for User Presets
            loadUserPresets();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // RECALL STORAGE SETTINGS
        // ~~~~~~~~~~~~~~~~~~~~
        function recallSettings() {
            // Set dark mode if previously set or sys pref
            if (localStorage.getItem("color-mode") === "dark" || (window.matchMedia("(prefers-color-scheme: dark)").matches && !localStorage.getItem("color-mode"))) enableDarkMode();

            // Get copy results setting
            if (localStorage.getItem("copy-setting")) {
                $("#copyResultsSetting").val(localStorage.getItem("copy-setting"));
                if (localStorage.getItem("copy-setting") === "Copy WITHOUT processing") {
                    $("#copyResultsWarning").show();
                    $("#copyResultsWarning2").show();
                } else {
                    $("#copyResultsWarning").hide();
                    $("#copyResultsWarning2").hide();
                }
            }

            // Get render metadata setting
            if (localStorage.getItem("ixml-setting")) {
                $("#iXMLSettings").prop('checked',true);
                $("#metadataWarning").show();
            } else {
                $("#iXMLSettings").prop('checked',false);
            }

            // Get extended metadata setting
            if (localStorage.getItem("metadata-setting")) {
                $("#metadataSettings").prop('checked',true);
                $("#metadataWarning").show();
                $("#metadataTitle").show();
                $("#metadataSection").show();
                $("#metadataScroll").show();
            } else {
                $("#metadataSettings").prop('checked',false);
                $("#metadataTitle").hide();
                $("#metadataSection").hide();
                $("#metadataScroll").hide();
            }

            // Get vendor cat setting
            if (localStorage.getItem("vendor-cat-setting")) {
                $("#vendorCatCheckbox").prop('checked',true);
                $("#vendorCategoryGroup").show();
            } else {
                $("#vendorCatCheckbox").prop('checked',false);
                $("#vendorCategoryGroup").hide();
            }

            // Hide metadata warning
            if (!localStorage.getItem("ixml-setting") && !localStorage.getItem("metadata-setting")) {
                $("#metadataWarning").hide();
            }

            // Get name/source capitalization settings
            if (localStorage.getItem("caps-setting")) {
                $("#nameCapitalizationSetting").val(localStorage.getItem("caps-setting"));
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // DROP-DOWN AUTOFILL
        // ~~~~~~~~~~~~~~~~~~~~
        var substringMatcher = function (strs) {
            return function findMatches(q, cb) {
                var matches, substringRegex;

                // an array that will be populated with substring matches
                matches = [];

                // regex used to determine if a string contains the substring `q`
                substrRegex = new RegExp(q, 'i');

                // iterate through the pool of strings and for any string that
                // contains the substring `q`, add it to the `matches` array
                $.each(strs, function (i, str) {
                    if (substrRegex.test(str)) {
                        matches.push(str);
                    }
                });

                cb(matches);
            };
        };

        // ~~~~~~~~~~~~~~~~~~~~
        // CATEGORY AUTOFILL INIT
        // ~~~~~~~~~~~~~~~~~~~~
        $('#typeaheadCategory .typeahead').typeahead({
            hint: true,
            highlight: true
        },
            {
                name: 'jsonCategoryAutofill',
                source: substringMatcher(jsonCategoryAutofill)
            });

        // ~~~~~~~~~~~~~~~~~~~~
        //   LIGHT / DARK MODE
        // ~~~~~~~~~~~~~~~~~~~~
        const toggleColorMode = e => {
            /* ENABLE LIGHT MODE */
            if (e.currentTarget.classList.contains("light--hidden")) {
                enableLightMode();
                return;
            }

            /* ENABLE DARK MODE */
            enableDarkMode();
        }

        const toggleColorButtons = document.querySelectorAll(".color-mode__btn");
        toggleColorButtons.forEach(btn => {
            btn.addEventListener("click", toggleColorMode);
        });

        function enableDarkMode() {
            document.documentElement.setAttribute("color-mode","dark");
            localStorage.setItem("color-mode","dark");

            $("#UCRTDataTable").removeClass("table-light");
            $("#UCRTDataTable").addClass("table-dark");

            $("#ucsNavbar").removeClass("navbar-light");
            $("#ucsNavbar").addClass("navbar-dark");

            $("#UCSInstallInstructions").removeClass("border-dark");
            $("#UCSInstallInstructions").addClass("border-light");

            $("#UCSOnlineModeInstructions").removeClass("border-dark");
            $("#UCSOnlineModeInstructions").addClass("border-light");
        }

        function enableLightMode() {
            document.documentElement.setAttribute("color-mode","light");
            localStorage.setItem("color-mode","light");
            
            $("#UCRTDataTable").removeClass("table-dark");
            $("#UCRTDataTable").addClass("table-light");

            $("#ucsNavbar").removeClass("navbar-dark");
            $("#ucsNavbar").addClass("navbar-light");

            $("#UCSInstallInstructions").removeClass("border-light");
            $("#UCSInstallInstructions").addClass("border-dark");

            $("#UCSOnlineModeInstructions").removeClass("border-light");
            $("#UCSOnlineModeInstructions").addClass("border-dark");
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // SUBMIT BUTTON & LUA TRIGGER
        // ~~~~~~~~~~~~~~~~~~~~
        // FORMAT: CatID_File Name with Variation Number_Initials_(Show)
        // NEW FORMAT: CatID(-UserCategory)_(VendorCategory-)File Name with Variation Number_Initials_(Show)
        $("#formSubmitButton").click(function (e) {
            // Check for wildcard/search type mismatch
            wildcardCleanup();

            // Process user input
            var selectedCategory = $("#userInputCategory").val();
            var selectedSubcategory = $("select#userSelectSubCategory option:checked").val();
            var selectedCatID = getCatID(selectedCategory, selectedSubcategory); // This function also alerts user if cat/subcat combo is invalid
            var nameAndNum = getNameAndNumber($("#userInputName").val());
            var nameOnly = nameAndNum[0];
            var numOnly = nameAndNum[1];
            var enableNum = $("#userInputVarNumCheckbox").prop("checked");
            var iXMLChecked = $("#iXMLSettings").prop("checked");
            var vendorChecked = $("#vendorCatCheckbox").prop("checked");
            var metadataChecked = $("#metadataSettings").prop("checked");
            var cleanUserCat = stringCleaning($("#userInputUserCat").val());
            var cleanInitials = stringCleaning($("#userInputInitials").val());
            var cleanShow = stringCleaning($("#userInputShow").val());
            var cleanUserData = stringCleaning($("#userInputData").val());

            // Alert user of invalid entries and bypass triggering ReaScript
            if (selectedCatID == "CATID_INVALID") { return; }                           // Alert is included in getCatID above
            if (nameOnly == "") { $("#userInputNameError").show(); $("#userCategoryGroup")[0].scrollIntoView(); return; }
            if (cleanInitials == "") { $("#userInitialsError").show(); $("#fileNameGroup")[0].scrollIntoView(); return; }

            // Trigger CSS Animation
            $("#formSubmitButton").addClass('anim-trig');
            $("#formSubmitButton").one('webkitAnimationEnd oanimationend msAnimationEnd animationend',
                function (e) {
                    // Code to execute after animation ends
                    $("#formSubmitButton").removeClass('anim-trig');
                });

            // Set project extstates from processed vars
            setProjExtState(selectedCategory, "Category");
            setProjExtState(selectedSubcategory, "Subcategory");
            setProjExtState(selectedCatID, "CatID");
            setProjExtState(nameOnly, "Name");
            setProjExtState(numOnly, "Number");
            setProjExtState(enableNum, "EnableNum");
            setProjExtState(iXMLChecked, "iXMLMetadata");
            setProjExtState(metadataChecked, "ExtendedMetadata");
            setProjExtState(cleanUserCat, "UserCategory");
            setProjExtState(cleanInitials, "Initials");
            setProjExtState(cleanShow, "Show");
            setProjExtState(cleanUserData, "Data");

            // Set project extstates from HTML vals
            setProjExtState("userInputItems");
            setProjExtState("userInputArea");
            setProjExtState("nameCapitalizationSetting");
            setProjExtState("copyResultsSetting");

            // Vendor category
            console.log("Vendor checked = " + vendorChecked);
            if (vendorChecked) {
                var vendorCat = stringCleaning($("#userInputVendCat").val());
                setProjExtState(vendorCat, "VendorCategory");
            } else {
                setProjExtState("false", "VendorCategory");
            }

            // Set project extstates for extended metadata fields             
            if (metadataChecked) {
                // Extended metadata fields
                var metaTitle  = stringCleaning($("#userInputMetaTitle").val());
                var metaDesc   = $("#userInputMetaDesc").val();
                var metaKeys   = stringCleaning($("#userInputMetaKeys").val());
                var metaMic    = stringCleaning($("#userInputMetaMic").val());
                var metaRecMed = stringCleaning($("#userInputMetaRecMed").val());
                var metaDsgnr  = stringCleaning($("#userInputMetaDsgnr").val());
                var metaLib    = stringCleaning($("#userInputMetaLib").val());                
                var metaURL    = $("#userInputMetaURL").val();

                // Extended metadata - location
                var metaCoun   = $("#countryId").val();
                var metaState  = $("#stateId").val();
                var metaCity   = $("#cityId").val();
                var metaLoc    = "";
                if (metaCoun != "Please wait.." && metaCoun != "Select Country" && metaCoun != "") metaLoc = metaCoun;                
                if (metaState != "Please wait.." && metaState != "Select State" && metaState != "") {
                    (metaLoc != "") ? metaLoc = metaLoc + ", " + metaState : metaLoc = metaState;
                }
                if (metaCity != "Please wait.." && metaCity != "Select City" && metaCity != "") {
                    (metaLoc != "") ? metaLoc = metaLoc + ", " + metaCity : metaLoc = metaCity;
                }

                // Extended metadata - mic perspective
                var metaPersp  = $("#userInputMetaPersp").val();
                var metaIntExt = $("#userInputMetaIntExt").val();
                if (metaPersp != "-" && metaIntExt != "-") {
                    metaPersp = metaPersp.match(/\((.*)\)/).pop() + " | " + metaIntExt.match(/\((.*)\)/).pop();
                } else if  (metaPersp != "-" && metaIntExt == "-") {
                    metaPersp = metaPersp.match(/\((.*)\)/).pop();
                } else if  (metaPersp == "-" && metaIntExt != "-") {
                    metaPersp = metaIntExt.match(/\((.*)\)/).pop();
                } else if  (metaPersp == "-" && metaIntExt == "-") {
                    metaPersp = "";
                }
                
                
                setProjExtState(metaTitle, "MetaTitle");
                setProjExtState(metaDesc, "MetaDesc");
                setProjExtState(metaKeys, "MetaKeys");
                setProjExtState(metaMic, "MetaMic");
                setProjExtState(metaRecMed, "MetaRecMed");
                setProjExtState(metaDsgnr, "MetaDsgnr");
                setProjExtState(metaLib, "MetaLib")
                setProjExtState(metaLoc, "MetaLoc");
                setProjExtState(metaURL, "MetaURL");
                setProjExtState(metaPersp, "MetaPersp");
            }

            // Tell ReaScript that this is being run from a web interface
            wwr_req("SET/EXTSTATEPERSIST/UCS_WebInterface/" + "runFromWeb" + "/" + "true");

            // Run ReaScript
            wwr_req(encodeURIComponent(UCSRTLua));
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // CLICK ON TABLE ROW
        // ~~~~~~~~~~~~~~~~~~~~
        $('#UCRTDataTable').on('click', 'tbody tr', function () {
            var tbl = $('#UCRTDataTable').DataTable();
            var row = tbl.row($(this)).data();
            
            // Read settings checkboxes
            var autoSubmit = $("#autoSubmitCheckbox").prop("checked");
            var autoSearchCatSubcat = $("#autoSearchCatSubcatCheckbox").prop("checked");
            var autoSearchSynonyms = $("#autoSearchSynonymsCheckbox").prop("checked");

            // Trigger row change so form updates
            $("#userInputCategory").val(row[0]).trigger('change');
            $("select#userSelectSubCategory").val(row[1]).trigger('change');

            $("#copiedRowAlert").html("<i>Copied data to form!</i><br />Cat: <b>" + row[0] + "</b><br />Sub: <b>" + row[1] + "</b>");
            $(".copy-alert").fadeTo(4000, 500).slideUp(750);

            // Auto search media explorer (see func below)
            if (autoSearchCatSubcat && autoSearchSynonyms) searchMediaExplorer(row[2] + ", " + row[1] + ", " + row[5]); // CATsub, Sub, Syn
            else if (autoSearchCatSubcat) searchMediaExplorer(row[2]);                                                  // CATsub
            else if (autoSearchSynonyms) searchMediaExplorer(row[1] + ", " + row[5]);                                   // Sub, Syn

            // Auto submit form on row click
            if (autoSubmit) $("#formSubmitButton").click();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SEARCH MEDIA EXPLORER FUNCTIONS
        // ~~~~~~~~~~~~~~~~~~~~
        function searchMediaExplorer(search) {
            // Set project extstates from HTML vals
            setProjExtState(search, "searchMediaExplorer");

            // Run ReaScript
            wwr_req(encodeURIComponent(UCSMediaFilter));
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // TRIGGER SUBMIT ON ENTER KEY
        // ~~~~~~~~~~~~~~~~~~~~
        $(document).keydown(function (event) {
            if (event.which === 13) {
                var categoryFocused = $('#userInputCategory').is(':focus');
                if (!categoryFocused) {
                    $("#formSubmitButton").click();
                }                
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // DOWNLOAD "UCS.txt" FILE
        // ~~~~~~~~~~~~~~~~~~~~
        $("#downloadUCSButton").click(function (e) {
            $("#UCSInstallInstructions").show();
            $("#downloadUCSButtonText").hide();
            downloadBlobFile();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // REENABLE ONLINE MODE INSTRUCTIONS
        // ~~~~~~~~~~~~~~~~~~~~
        $("#onlineUCSButton").click(function (e) {
            if (onlineModeInstructionsToggle) {
                $("#UCSOnlineModeInstructions").show();
                onlineModeInstructionsToggle = false;
                // Open Reaper resource path
                wwr_req(encodeURIComponent(REApath));
            } else {
                $("#UCSOnlineModeInstructions").hide();
                onlineModeInstructionsToggle = true;
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // BUILD SUBCATEGORY ARRAY BASED ON CATEGORY
        // ~~~~~~~~~~~~~~~~~~~~
        $("#userInputCategory").change(function () {
            var $dropdown = $(this);
            var key = $dropdown.val();
            var vals = [];
            if (jsonCategorySubcategoryArr.hasOwnProperty(key)) {
                document.getElementById("userInputCategory").setCustomValidity("");
                document.getElementById("userSelectSubCategory").setCustomValidity("");
                vals = jsonCategorySubcategoryArr[key].split(", ");
                $("#userInputCategoryError").hide();
            } else {
                document.getElementById("userInputCategory").setCustomValidity("Invalid");
                document.getElementById("userSelectSubCategory").setCustomValidity("Invalid");
                vals = ['Please select a valid category!'];
            }

            var $secondChoice = $("#userSelectSubCategory");
            $secondChoice.empty();
            $.each(vals, function (index, value) {
                $secondChoice.append("<option>" + value + "</option>");
            });
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // BUILD SEARCH AREA OPTIONS BASED ON REGION/MARKER/ITEM/TRACK SELECTION
        // ~~~~~~~~~~~~~~~~~~~~
        $("#userInputItems").change(function () {
            var key = $(this).val();
            var vals = [];

            // Clean up wildcard info based on search type
            wildcardCleanup();
            
            switch (key) {
                case "Regions":
                    // Remove selected regions option for mac users for now
                    if (isMac) {
                        vals = ["Edit Cursor", "Time Selection", "Full Project"];
                    } else {
                        vals = ["Selected Regions in Region Manager", "Edit Cursor", "Time Selection", "Full Project"];
                    }
                    break;

                case "Markers":
                    // Remove selected markers option for mac users for now
                    if (isMac) {
                        vals = ["Time Selection", "Full Project"];
                    } else {
                        vals = ["Selected Markers in Marker Manager", "Time Selection", "Full Project"];
                    }
                    break;

                case "Media Items":
                    vals = ["Selected Items", "All Items"];
                    break;

                case "Tracks":
                    // Remove selected tracks option for mac users for now
                    if (isMac){
                        vals = ["Selected Tracks", "All Tracks"];
                    } else {
                        vals = ["Selected Tracks", "Selected in Track Manager", "All Tracks"];
                    }
                    break;

                default:
                    break;
            }

            // Set up search area options based on search item
            var $secondChoice = $("#userInputArea");
            $secondChoice.empty();
            $.each(vals, function (index, value) {
                $secondChoice.append("<option>" + value + "</option>");
            });            
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // UPDATE NAVBAR HIGHLIGHTS W SCROLL
        // ~~~~~~~~~~~~~~~~~~~~
        $( window ).scroll(function() {
            var removeScrollClasses = function (el1, el2, el3) {
                $(el1).removeClass("active");
                $(el2).removeClass("active");
                $(el3).removeClass("active");
            }

            var processingOffset = $("#userInputData").offset().top - $(window).scrollTop();
            var metadataOffset = $("#userInputArea").offset().top - $(window).scrollTop();
            var dataOffset = $("#formSubmitButton").offset().top - $(window).scrollTop();
            var posBuffer = 200;

            if (dataOffset < posBuffer) {
                removeScrollClasses("#metadataScroll", "#processingScroll", "#namingScroll");
                $("#dataScroll").addClass("active");

            } else if (metadataOffset < posBuffer && localStorage.getItem("metadata-setting")) {
                removeScrollClasses("#dataScroll", "#processingScroll", "#namingScroll");
                $("#metadataScroll").addClass("active");

            } else if (processingOffset < posBuffer) {
                removeScrollClasses("#metadataScroll", "#dataScroll", "#namingScroll");
                $("#processingScroll").addClass("active");

            } else {
                removeScrollClasses("#metadataScroll", "#processingScroll", "#dataScroll");
                $("#namingScroll").addClass("active");
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // WILDCARD CLEANUP
        // ~~~~~~~~~~~~~~~~~~~~
        // Change info under file name field to match current supported wildcards
        // If filename field has wildcard info that doesn't match current item selection, then change it
        function wildcardCleanup() {
            var search_field = $("#userInputItems").val();
            var cur_name = $("#userInputName").val();

            var number_info = "<b>WILDCARDS: </b>";
            var closer_info = "<br />- Available wildcards are dependent on 'Items to Rename' field in <i>Processing</i> below.";

            switch (search_field) {
                case "Regions":
                    // Change text below filenaming section to clarify wildcard support
                    var wildcard_info = "$region, $regionnumber";
                    $("#userInputNameHelp").html(number_info + wildcard_info + closer_info);

                    // Naming
                    if (cur_name.includes("$marker")) cur_name = cur_name.replace("$marker", "$region");
                    if (cur_name.includes("$item")) cur_name = cur_name.replace("$item", "$region");
                    if (cur_name.includes("$track")) cur_name = cur_name.replace("$track", "$region");

                    // Numbering
                    if (cur_name.includes("$markernumber")) cur_name = cur_name.replace("$markernumber", "$regionnumber");
                    if (cur_name.includes("$itemnumber")) cur_name = cur_name.replace("$itemnumber", "$regionnumber");
                    if (cur_name.includes("$tracknumber")) cur_name = cur_name.replace("$tracknumber", "$regionnumber");

                    $("#userInputName").val(cur_name)
                    break;

                case "Markers":
                    var wildcard_info = "$marker, $markernumber";
                    $("#userInputNameHelp").html(number_info + wildcard_info + closer_info);

                    if (cur_name.includes("$region")) cur_name = cur_name.replace("$region", "$marker");
                    if (cur_name.includes("$item")) cur_name = cur_name.replace("$item", "$marker");
                    if (cur_name.includes("$track")) cur_name = cur_name.replace("$track", "$marker");

                    if (cur_name.includes("$regionnumber")) cur_name = cur_name.replace("$regionnumber", "$markernumber");
                    if (cur_name.includes("$itemnumber")) cur_name = cur_name.replace("$itemnumber", "$markernumber");
                    if (cur_name.includes("$tracknumber")) cur_name = cur_name.replace("$tracknumber", "$markernumber");

                    $("#userInputName").val(cur_name)
                    break;

                case "Media Items":
                    var wildcard_info = "$item, $itemnumber";
                    $("#userInputNameHelp").html(number_info + wildcard_info + closer_info);

                    if (cur_name.includes("$marker")) cur_name = cur_name.replace("$marker", "$item");
                    if (cur_name.includes("$region")) cur_name = cur_name.replace("$region", "$item");
                    if (cur_name.includes("$track")) cur_name = cur_name.replace("$track", "$item");

                    if (cur_name.includes("$markernumber")) cur_name = cur_name.replace("$markernumber", "$itemnumber");
                    if (cur_name.includes("$regionnumber")) cur_name = cur_name.replace("$regionnumber", "$itemnumber");
                    if (cur_name.includes("$tracknumber")) cur_name = cur_name.replace("$tracknumber", "$itemnumber");

                    $("#userInputName").val(cur_name)
                    break;

                case "Tracks":
                    var wildcard_info = "$track, $tracknumber";
                    $("#userInputNameHelp").html(number_info + wildcard_info + closer_info);

                    if (cur_name.includes("$marker")) cur_name = cur_name.replace("$marker", "$track");
                    if (cur_name.includes("$item")) cur_name = cur_name.replace("$item", "$track");
                    if (cur_name.includes("$region")) cur_name = cur_name.replace("$region", "$track");

                    if (cur_name.includes("$markernumber")) cur_name = cur_name.replace("$markernumber", "$tracknumber");
                    if (cur_name.includes("$itemnumber")) cur_name = cur_name.replace("$itemnumber", "$tracknumber");
                    if (cur_name.includes("$regionnumber")) cur_name = cur_name.replace("$regionnumber", "$tracknumber");

                    $("#userInputName").val(cur_name)
                    break;

                default:
                    break;
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // VALIDATE ALL FIELDS ON KEYPRESS
        // ~~~~~~~~~~~~~~~~~~~~
        $("input[type='text']").change(function () {
            // Delayed form check to allow for default preset load
            var loadedSeconds = (new Date().valueOf() - startTime) / 1000;            
            if (loadedSeconds > 1) {
                // validateCategory();
                // Fetch form to apply custom Bootstrap validation
                var form = $("#ucsForm")

                if (form[0].checkValidity() === false) {
                    event.preventDefault()
                    event.stopPropagation()
                }

                form.addClass('was-validated');
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // VALIDATE NAME FIELD
        // ~~~~~~~~~~~~~~~~~~~~
        $("#userInputName").keyup(function () {
            if (document.getElementById("userInputName").checkValidity() === true) {
                $("#userInputNameError").hide();
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // VALIDATE INITIALS FIELD
        // ~~~~~~~~~~~~~~~~~~~~
        $("#userInputInitials").keyup(function () {
            if (document.getElementById("userInputInitials").checkValidity() === true) {
                $("#userInitialsError").hide();
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // COPY WITHOUT PROCESSING ALERT
        // ~~~~~~~~~~~~~~~~~~~~
        $("#copyResultsSetting").change(function () {
            var key = $(this).val();
            localStorage.setItem("copy-setting",key); // Set value in local storage
            switch (key) {
                case "Copy WITHOUT processing":
                    $("#copyResultsWarning").show();
                    $("#copyResultsWarning2").show();
                    break;

                default:
                    $("#copyResultsWarning").hide();  
                    $("#copyResultsWarning2").hide();      
                    break;
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // UCS iXML RENDERING ON CHANGE
        // ~~~~~~~~~~~~~~~~~~~~
        $("#iXMLSettings").change(function () {
            var iXMLChecked = $(this).prop("checked");
            if (iXMLChecked) {
                localStorage.setItem("ixml-setting",iXMLChecked); // Set value in local storage
                $("#metadataWarning").show();
            } else {            
                localStorage.removeItem("ixml-setting");
                if (!$("#metadataSettings").prop("checked")) {
                    $("#metadataWarning").hide();
                }
            }
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // EXTENDED METADATA TOGGLE ON CHANGE
        // ~~~~~~~~~~~~~~~~~~~~
        $("#metadataSettings").change(function () {
            var metadataChecked = $(this).prop("checked");
            if (metadataChecked) {
                localStorage.setItem("metadata-setting",metadataChecked);
                $("#metadataWarning").show();
                $("#metadataTitle").show();
                $("#metadataSection").show();
                $("#metadataScroll").show();
            } else {
                localStorage.removeItem("metadata-setting");
                $("#metadataTitle").hide();
                $("#metadataSection").hide();
                $("#metadataScroll").hide();
                if (!$("#iXMLSettings").prop("checked")) {
                    $("#metadataWarning").hide();
                }
            }
        })

        // ~~~~~~~~~~~~~~~~~~~~
        // VENDOR CAT CHECKBOX TOGGLE ON CHANGE
        // ~~~~~~~~~~~~~~~~~~~~
        $("#vendorCatCheckbox").change(function () {
            var vendorCatChecked = $(this).prop("checked");
            if (vendorCatChecked) {
                localStorage.setItem("vendor-cat-setting",vendorCatChecked);
                $("#vendorCategoryGroup").show();
            } else {
                localStorage.removeItem("vendor-cat-setting");
                $("#vendorCategoryGroup").hide();
            }
        })

        // ~~~~~~~~~~~~~~~~~~~~
        // LOG ALBUM ART ON INPUT CHANGE
        // ~~~~~~~~~~~~~~~~~~~~
        $("#userInputMetaArt").on("change", function() {
            var fullName = $(this).file().name[0];
            var fileName = $(this).val().split("\\").pop();
            console.log(fullName);
            console.log(fileName);
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // STORE CAPITALIZATION SETTINGS
        // ~~~~~~~~~~~~~~~~~~~~
        $("#nameCapitalizationSetting").change(function () {
            var key = $(this).val();
            localStorage.setItem("caps-setting",key); // Set value in local storage
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - English
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langEN").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_en);
            localStorage.setItem("ucs_language_country", "us");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Spanish
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langES").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_es);
            localStorage.setItem("ucs_language_country", "es");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - French
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langFR").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_fr);
            localStorage.setItem("ucs_language_country", "fr");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - German
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langDE").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_de);
            localStorage.setItem("ucs_language_country", "de");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Italian
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langIT").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_it);
            localStorage.setItem("ucs_language_country", "it");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Polish
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langPL").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_pl);
            localStorage.setItem("ucs_language_country", "pl");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Dutch
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langNL").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_nl);
            localStorage.setItem("ucs_language_country", "nl");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Danish
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langDA").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_da);
            localStorage.setItem("ucs_language_country", "dk");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Finnish
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langFI").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_fi);
            localStorage.setItem("ucs_language_country", "fi");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Portuguese
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langPT").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_pt);
            localStorage.setItem("ucs_language_country", "pt");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Portuguese - Brazil
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langPTBR").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_pt_br);
            localStorage.setItem("ucs_language_country", "br");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Chinese
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langZH").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_zh);
            localStorage.setItem("ucs_language_country", "cn");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Japanese
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langJA").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_ja);
            localStorage.setItem("ucs_language_country", "jp");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Taiwan
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langTW").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_tw);
            localStorage.setItem("ucs_language_country", "tw");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Norway
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langNO").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_no);
            localStorage.setItem("ucs_language_country", "no");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Sweden
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langSE").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_se);
            localStorage.setItem("ucs_language_country", "se");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Russian
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langRU").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_ru);
            localStorage.setItem("ucs_language_country", "ru");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // SET LANGUAGE - Ukrainian
        // ~~~~~~~~~~~~~~~~~~~~
        $("#langUA").click(function (e) {
            localStorage.setItem("ucs_language", ucs_gsheet_ua);
            localStorage.setItem("ucs_language_country", "ua");
            location.reload();
        });

        // ~~~~~~~~~~~~~~~~~~~~
        // GET UCS LANGUAGE COUNTRY ICON
        // ~~~~~~~~~~~~~~~~~~~~
        function getUCSLanguage() {
            // Parse JSON from Google Sheet
            var ucs_lang_country = "";

            if (localStorage.getItem("ucs_language_country") !== null) {
                ucs_lang_country = localStorage.getItem("ucs_language_country");
            } else {
                // Default to English/US
                localStorage.setItem("ucs_language_country", "us");
                ucs_lang_country = "us";
            }

            $("#navbarLangDropdown").html('<i class="flag ' + ucs_lang_country + '"></i>&nbsp;&nbsp;Language');
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // CHECK FOR OFFLINE UCS DOC
        // ~~~~~~~~~~~~~~~~~~~~
        function loadOfflineUCSDoc() {
            var xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log("Found local UCS data file. Entering OFFLINE mode.");
                    useOfflineUSCData(this.responseText);
                }
            };
            xhttp.onloadend = function () {
                if (xhttp.status == 404) {
                    console.log("No local UCS data file found. Entering ONLINE mode (GSheets data).");
                    useGSheetsUSCData();
                }
            }
            xhttp.open("GET", "UCS.txt", true);
            // XML HTTP Cache will try to pull old information if the file is update but keeps the same name.
            // Disable cache controls to get the latest.
            xhttp.setRequestHeader('cache-control', 'no-cache, must-revalidate, post-check=0, pre-check=0');
            xhttp.setRequestHeader('cache-control', 'max-age=0');
            xhttp.setRequestHeader('expires', '0');
            xhttp.setRequestHeader('expires', 'Tue, 01 Jan 1980 1:00:00 GMT');
            xhttp.setRequestHeader('pragma', 'no-cache');
            xhttp.send();
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // CHECK FOR OFFLINE USER PRESETS DOC
        // ~~~~~~~~~~~~~~~~~~~~
        function loadUserPresets() {
            // Load presets
            if (localStorage.getItem("num-presets") !== null) {
                // Found existing number of presets
                var num_presets = parseInt(localStorage.getItem("num-presets"), 10);
                for (var preset_index = 1; preset_index <= num_presets; preset_index++) {
                    if (localStorage.getItem("ucs-preset-" + preset_index) !== null) {
                        // Parse JSON
                        var presetSettings = JSON.parse(localStorage.getItem("ucs-preset-" + preset_index));
                        
                        // Add dropdown element for preset to top of list
                        $("#navbarPresetsDropdownOptions").prepend('<a class="dropdown-item" href="#" id="userPreset' + preset_index + '" onClick="loadUserPreset(' + preset_index + ')" style="display: flex; align-items: center;">' + presetSettings.preset + '</a>');
                        
                        // Add dropdown element to DELETE preset
                        $("#deletePresetSelect").prepend($('<option>', {
                            value: preset_index, 
                            text: presetSettings.preset
                        }));

                        // Load to fields if "Default"
                        if (presetSettings.preset.toUpperCase() == "DEFAULT") loadUserPreset(preset_index);
                    }
                }
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // SHOW PRESET MODAL
        // ~~~~~~~~~~~~~~~~~~~~
        function showPresetModal() {
            $('#presetsModal').modal();
            setTimeout(() => { $('#presetName').focus(); }, 500);
        }

        function showDeletePresetModal() {
            $('#deletePresetsModal').modal();
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // SAVE CURRENT SETTINGS AS A PRESET
        // ~~~~~~~~~~~~~~~~~~~~
        function saveThisAsPreset() {
            // Hide modal
            $('#presetsModal').modal('hide');            

            // Get user's settings            
            var mySettings = {
                presetIndex: preset_index,
                preset: $("#presetName").val(),
                category: $("#userInputCategory").val(),
                subcategory: $("select#userSelectSubCategory option:checked").val(),
                filename: $("#userInputName").val(),
                enumerate: $("#userInputVarNumCheckbox").prop("checked"),
                userCat: $("#userInputUserCat").val(),
                userId: $("#userInputInitials").val(),
                showId: $("#userInputShow").val(),
                userData: $("#userInputData").val(),
                vendorCat: $("#userInputVendCat").val(),
                metaTitle: $("#userInputMetaTitle").val(),
                metaDesc: $("#userInputMetaDesc").val(),
                metaKeys: $("#userInputMetaKeys").val(),
                metaMic: $("#userInputMetaMic").val(),
                metaRecMed: $("#userInputMetaRecMed").val(),
                metaDsgnr: $("#userInputMetaDsgnr").val(),
                metaLib: $("#userInputMetaLib").val(),        
                metaURL: $("#userInputMetaURL").val(),
                metaCoun: $("#countryId").val(),
                metaState: $("#stateId").val(),
                metaCity: $("#cityId").val(),
                metaPersp: $("#userInputMetaPersp").val(),
                metaIntExt: $("#userInputMetaIntExt").val(),
                userItems: $("#userInputItems").val(),
                userArea: $("#userInputArea").val()
            }
            console.log(mySettings);
            
            // Get/update number of user presets in local storage
            var preset_index = 0;
            var edit_mode = false;
            if (localStorage.getItem("num-presets") !== null) {
                // Check to see if an existing preset has the same name. Delete if so
                var num_presets = parseInt(localStorage.getItem("num-presets"), 10);
                for (var preset_idx = 1; preset_idx <= num_presets; preset_idx++) {
                    if (localStorage.getItem("ucs-preset-" + preset_idx) !== null) {                        
                        var presetSettings = JSON.parse(localStorage.getItem("ucs-preset-" + preset_idx));
                        // Found a match
                        if (presetSettings.preset === mySettings.preset) {                                                    
                            localStorage.removeItem("ucs-preset-" + preset_idx);
                            console.log("Edited preset: " + presetSettings.preset);
                            edit_mode = true;
                            preset_index = preset_idx;
                        }                    
                    }
                }                
                // Didn't find existing preset with same name
                if (!edit_mode) {
                    preset_index = parseInt(localStorage.getItem("num-presets"), 10) + 1;
                    localStorage.setItem("num-presets", preset_index.toString());
                    console.log("Added preset: " + mySettings.preset);
                }
            } else {
                // No presets stored yet
                localStorage.setItem("num-presets", "1");
                preset_index = 1;
                console.log("Started new preset collection: " + mySettings.preset);
            }

            // Store current preset
            var settingsString = JSON.stringify(mySettings);
            localStorage.setItem("ucs-preset-" + preset_index,settingsString);
            
            // Update dropdowns
            if (!edit_mode) {
                // Add dropdown element for preset to top of list
                $("#navbarPresetsDropdownOptions").prepend('<a class="dropdown-item" href="#" id="userPreset' + preset_index + '" onClick="loadUserPreset(' + preset_index + ')" style="display: flex; align-items: center;">' + mySettings.preset + '</a>');
            
                // Add dropdown element to DELETE preset
                $("#deletePresetSelect").prepend($('<option>', {
                    value: preset_index, 
                    text: mySettings.preset
                }));
            }

            // Clear out preset name entry spot
            $("#presetName").val("").trigger('change');
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // LOAD USER PRESETS
        // ~~~~~~~~~~~~~~~~~~~~
        function loadUserPreset(index) {
            // Close presets dropdown menu, if open
            if ($('#navbarPresetsDropdownOptions').hasClass("show")) $("#navbarPresetsDropdown").dropdown("toggle");
            
            // Fetch preset
            var presetSettings = JSON.parse(localStorage.getItem("ucs-preset-" + index));
            
            // Set values
            console.log("Loading preset number: " + index);
            if (presetSettings.category !== "") $("#userInputCategory").val(presetSettings.category).trigger('change');
            if (presetSettings.subcategory !== "Please select a category!") $("#userSelectSubCategory").val(presetSettings.subcategory).trigger('change');
            if (presetSettings.filename !== "") $("#userInputName").val(presetSettings.filename).trigger('change');            
            if (presetSettings.userCat !== "") $("#userInputUserCat").val(presetSettings.userCat).trigger('change');
            if (presetSettings.userId !== "") $("#userInputInitials").val(presetSettings.userId).trigger('change');
            if (presetSettings.showId !== "") $("#userInputShow").val(presetSettings.showId).trigger('change');
            if (presetSettings.userData !== "") $("#userInputData").val(presetSettings.userData).trigger('change');
            if (presetSettings.vendorCat !== "") $("#userInputVendCat").val(presetSettings.vendorCat).trigger('change');
            if (presetSettings.metaTitle !== "") $("#userInputMetaTitle").val(presetSettings.metaTitle).trigger('change');
            if (presetSettings.metaDesc !== "") $("#userInputMetaDesc").val(presetSettings.metaDesc).trigger('change');
            if (presetSettings.metaKeys !== "") $("#userInputMetaKeys").val(presetSettings.metaKeys).trigger('change');
            if (presetSettings.metaMic !== "") $("#userInputMetaMic").val(presetSettings.metaMic).trigger('change');
            if (presetSettings.metaRecMed !== "") $("#userInputMetaRecMed").val(presetSettings.metaRecMed).trigger('change');
            if (presetSettings.metaDsgnr !== "") $("#userInputMetaDsgnr").val(presetSettings.metaDsgnr).trigger('change');
            if (presetSettings.metaLib !== "") $("#userInputMetaLib").val(presetSettings.metaLib).trigger('change');
            if (presetSettings.metaURL !== "") $("#userInputMetaURL").val(presetSettings.metaURL).trigger('change');
            if (presetSettings.metaCoun !== "") setTimeout(() => { $("#countryId").val(presetSettings.metaCoun).trigger('change'); }, 500);
            if (presetSettings.metaState !== "") setTimeout(() => { $("#stateId").val(presetSettings.metaState).trigger('change'); }, 1000);
            if (presetSettings.metaCity !== "") setTimeout(() => { $("#cityId").val(presetSettings.metaCity).trigger('change'); }, 1500);            
            if (presetSettings.metaPersp !== "-") $("#userInputMetaPersp").val(presetSettings.metaPersp).trigger('change');
            if (presetSettings.metaIntExt !== "-") $("#userInputMetaIntExt").val(presetSettings.metaIntExt).trigger('change');
            if (presetSettings.userItems !== "") $("#userInputItems").val(presetSettings.userItems).trigger('change');
            if (presetSettings.userArea !== "") $("#userInputArea").val(presetSettings.userArea).trigger('change');
            $("#userInputVarNumCheckbox").prop("checked",presetSettings.enumerate);
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // DELETE USER PRESETS
        // ~~~~~~~~~~~~~~~~~~~~
        function deleteThisPreset() {
            // Get index of selected option
            var preset_index_to_delete = parseInt($("#deletePresetSelect").val(), 10);
            
            // Fetch presets
            if (localStorage.getItem("num-presets") !== null) {
                // Found existing number of presets
                var num_presets = parseInt(localStorage.getItem("num-presets"), 10);
                for (var preset_index = 1; preset_index <= num_presets; preset_index++) {
                    // Delete the selected preset 
                    if (localStorage.getItem("ucs-preset-" + preset_index) !== null && preset_index == preset_index_to_delete) {                        
                        var presetSettings = JSON.parse(localStorage.getItem("ucs-preset-" + preset_index));
                        localStorage.removeItem("ucs-preset-" + preset_index_to_delete);
                        console.log("Deleted preset: " + presetSettings.preset);
                        
                        // Update dropdown elements for preset to top of list
                        $("#userPreset" + preset_index).remove();
                        
                        // Update dropdown elements for DELETE presets
                        $("#deletePresetSelect option[value=" + preset_index_to_delete + "]").remove();
                    }
                }
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // USE OFFLINE UCS DATA IF AVAILABLE
        // ~~~~~~~~~~~~~~~~~~~~
        function useOfflineUSCData(offlineTableData) {
            // Display appropriate HTML elements
            $("#UCSTableSubHeading").text("UCS Data Offline Mode");
            $("#reenableOnlineUCSButtonText").show();
            $("#onlineUCSButton").show();

            // Build full table from offline info
            jsonFullTable = JSON.parse(offlineTableData);

            // Loop through table data
            for (let [key, value] of Object.entries(jsonFullTable)) {
                var jsonCategory = value[0];
                var jsonSubcategory = value[1];
                var jsonCatID = value[2];
                var jsonShortID = value[3];
                var jsonExplanation = value[4];
                var jsonSynonym = value[5];

                // Build category & subcategory array for dynamic subcategories
                if (!jsonCategorySubcategoryArr.hasOwnProperty(jsonCategory)) {
                    jsonCategorySubcategoryArr[jsonCategory] = jsonSubcategory;
                } else {
                    jsonCategorySubcategoryArr[jsonCategory] = jsonCategorySubcategoryArr[jsonCategory] + ", " + jsonSubcategory;
                }

                // Build CatID array for Reaper
                if (!jsonCatIDArr.hasOwnProperty(jsonCatID)) {
                    jsonCatIDArr[jsonCatID] = jsonCategory + ", " + jsonSubcategory;
                } else {
                    console.log("There is a duplicate CatID: " + jsonCatID + "\n" + "Using first occurrence: " + jsonCatIDArr[jsonCatID]);
                }

                // Build autocomplete arrays
                if (!jsonCategoryAutofill.includes(jsonCategory) && jsonCategory != "Category") {
                    jsonCategoryAutofill.push(jsonCategory);
                }
                if (!jsonSubcategoryAutofill.includes(jsonSubcategory) && jsonSubcategory != "SubCategory" && jsonSubcategory != "-") {
                    jsonSubcategoryAutofill.push(jsonSubcategory);
                }
            }

            // Initialize data table
            $('#UCRTDataTable').DataTable({
                "paging": true,
                "info": false,
                "lengthChange": false,
                "pageLength": 50,
                data: jsonFullTable,
                columns: [
                    { title: "Category" },
                    { title: "Subcategory" },
                    { title: "CatID" },
                    { title: "ShortID" },
                    { title: "Explanations" },
                    { title: "Synonyms" }
                ],
                "dom": '<"dtSearch"f>rt<"dtPages"lp><"clear">'
            });

            $('.dataTables_filter input[type="search"]').css(
                { 'min-width': '500px', 'display': 'inline-block' }
            );
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // USE GOOGLE SHEET DATA IF UCS OFFLINE NOT AVAILABLE
        // ~~~~~~~~~~~~~~~~~~~~
        function useGSheetsUSCData() {
            // Display appropriate HTML elements
            $("#downloadUCSButton").show();
            $("#downloadUCSButtonText").show();

            // Parse JSON from Google Sheet
            var ucs_gsheet = "";

            if (localStorage.getItem("ucs_language") !== null) {
                console.log("Language preference found in local storage.")
                ucs_gsheet = localStorage.getItem("ucs_language");
            } else {
                console.log("No language preference set. Default: English.");
                localStorage.setItem("ucs_language", ucs_gsheet_en);
                localStorage.setItem("ucs_language_country", "us");
                ucs_gsheet = ucs_gsheet_en;
            }

            $.getJSON(ucs_gsheet, function (data) {
                var entry = data.feed.entry;
                // Loop through the JSON, starting on the second row (skip headers)
                // For this process to work, there CANNOT be any blank cells
                for (var i = 6; i < entry.length - 6; i += 6) {
                    // entry[i].content.$t retrieves the content of each cell
                    var jsonCategory = entry[i].content.$t;
                    var jsonSubcategory = entry[i + 1].content.$t;
                    var jsonCatID = entry[i + 2].content.$t;
                    var jsonShortID = entry[i + 3].content.$t;
                    var jsonExplanation = entry[i + 4].content.$t;
                    var jsonSynonym = entry[i + 5].content.$t;

                    // Build full table for DataTable
                    jsonFullTable.push([jsonCategory, jsonSubcategory, jsonCatID, jsonShortID, jsonExplanation, jsonSynonym]);

                    // Build category & subcategory array for dynamic subcategories
                    if (!jsonCategorySubcategoryArr.hasOwnProperty(jsonCategory)) {
                        jsonCategorySubcategoryArr[jsonCategory] = jsonSubcategory;
                    } else {
                        jsonCategorySubcategoryArr[jsonCategory] = jsonCategorySubcategoryArr[jsonCategory] + ", " + jsonSubcategory;
                    }

                    // Build CatID array for Reaper
                    if (!jsonCatIDArr.hasOwnProperty(jsonCatID)) {
                        jsonCatIDArr[jsonCatID] = jsonCategory + ", " + jsonSubcategory;
                    } else {
                        console.log("There is a duplicate CatID: " + jsonCatID + "\n" + "Using first occurrence: " + jsonCatIDArr[jsonCatID]);
                    }

                    // Build autocomplete arrays
                    if (!jsonCategoryAutofill.includes(jsonCategory) && jsonCategory != "Category") {
                        jsonCategoryAutofill.push(jsonCategory);
                    }
                    if (!jsonSubcategoryAutofill.includes(jsonSubcategory) && jsonSubcategory != "SubCategory" && jsonSubcategory != "-") {
                        jsonSubcategoryAutofill.push(jsonSubcategory);
                    }
                }

                // Initialize data table
                $('#UCRTDataTable').DataTable({
                    "paging": true,
                    "info": false,
                    "lengthChange": false,
                    "pageLength": 50,
                    data: jsonFullTable,
                    columns: [
                        { title: "Category" },
                        { title: "Subcategory" },
                        { title: "CatID" },
                        { title: "ShortID" },
                        { title: "Explanations" },
                        { title: "Synonyms" }
                    ],
                    "dom": '<"dtSearch"f>rt<"dtPages"lp><"clear">'
                });

                $('.dataTables_filter input[type="search"]').css(
                    { 'width': '100%', 'box-sizing': 'border-box', 'max-width': '500px', 'display': 'inline-block' }
                );
            })
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // SET REAPER PROJEXTSTATE
        // ~~~~~~~~~~~~~~~~~~~~
        // Can accept HTML element ID as input 1, will use element ID as extstate field name
        // Can accept other variables as input 1, with extstate field name as input 2 string
        function setProjExtState(field, extName = "") {
            var htmlEle = document.getElementById(field);
            if (htmlEle) {
                var val = htmlEle.value;
                wwr_req("SET/PROJEXTSTATE/UCS_WebInterface/" + field + "/" + val);
            } else {
                var val = field;
                wwr_req("SET/PROJEXTSTATE/UCS_WebInterface/" + extName + "/" + val);
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // FIND CATID FROM CAT & SUBCAT
        // ~~~~~~~~~~~~~~~~~~~~
        function getCatID(selectedCat, selectedSubcat) {
            var arrVal = selectedCat + ", " + selectedSubcat;
            if (Object.keys(jsonCatIDArr).find(key => jsonCatIDArr[key] === arrVal)) {
                var arrCatID = Object.keys(jsonCatIDArr).find(key => jsonCatIDArr[key] === arrVal);
                console.log("Found CatID: " + arrCatID);
                return arrCatID;
            } else {
                //alert("No valid CatID found." + "\n" + "\n" + "Please check your Category & Subcategory selections!");
                $("#userInputCategoryError").show();
                window.scrollTo(0,0);
                var invalid = "CATID_INVALID";
                return invalid;
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // CLEAN UP USER'S FILE NAME INPUT
        // ~~~~~~~~~~~~~~~~~~~~
        // Splits into name & number (formatted as string)
        // Uses RegEx to ensure name conforms to UCS standard (see RegEx function below)
        function getNameAndNumber(name) {
            var cleanName = stringCleaning(name);
            var matches = cleanName.match(/\d+$/);
            if (matches) {
                // If user included a number at the end of the name...
                var number = String(parseInt(matches[0], 10));
                var noNum = cleanName.replace(/\d+$/, "");
                var noSpace = stringCleaning(noNum);
                console.log("Name: " + noSpace + " | Number: " + number);
                return [noSpace, number];
            } else {
                // Start at 1 otherwise
                var number = "1";
                console.log("Name: " + cleanName + " | Number: " + number);
                return [cleanName, number];
            }
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // REGEX USER INPUT CLEANING
        // ~~~~~~~~~~~~~~~~~~~~
        // RegEx to clean up user input fields, see comments on right
        function stringCleaning(inString) {
            var noIllegalChars = inString.replace(/[\"\&\*\/\:\<\>\?\|\%\#\!\+\[\]\{\}]/g, "");    // Removes illegal characters
            var noLeadingWhitespace = noIllegalChars.replace(/^\s+/, "");                          // Removes whitespace at start of string
            var noTrailingWhitespace = noLeadingWhitespace.replace(/\s+$/, "");                    // Removes whitespace at end of string
            var noUnderscores = noTrailingWhitespace.replace(/_/g, " ");                           // Replaces underscores with spaces
            var noDoubleSpaces = noUnderscores.replace(/\s\s+/g, " ");                             // Removes double spaces, tabs, or multiple spaces in the middle of a string
            return noDoubleSpaces;
        }

        // ~~~~~~~~~~~~~~~~~~~~
        // DOWNLOAD "UCS.txt" BLOB FILE
        // ~~~~~~~~~~~~~~~~~~~~
        // Creates a text file from the Univ Cat System array
        // Spoofs a download link on the page for the created file, clicks it then removes spoof (sneaky)
        function downloadBlobFile() {
            // Open Reaper resource path
            wwr_req(encodeURIComponent(REApath));

            // Create text file from array input
            var textFile = null,
                makeTextFile = function (arr) {
                    var arrToText = new Blob([JSON.stringify(arr)], { type: 'text/plain' });
                    // If we are replacing a previously generated file we need to
                    // manually revoke the object URL to avoid memory leaks.
                    if (textFile !== null) {
                        window.URL.revokeObjectURL(textFile);
                    }
                    textFile = window.URL.createObjectURL(arrToText);
                    return textFile;
                };

            // Create page element for link to file
            var link = document.createElement('a');
            link.setAttribute('download', 'UCS.txt');
            link.href = makeTextFile(jsonFullTable);

            // Spoof user clicking on new download link
            document.body.appendChild(link);
            window.requestAnimationFrame(function () {
                var event = new MouseEvent('click');
                link.dispatchEvent(event);
                document.body.removeChild(link);
            });
        }
    </script>
</body>
</html>